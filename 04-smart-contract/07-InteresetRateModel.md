# InterestRateModel

엘리파이의 기본 이자율은 굴절된 직선 모델을 이용하고 있습니다.  남아있는 유동성의 비율이 얼마인지에 따라 예치 이자와 대출이자율이 변경됩니다. 특정 비율에 도달할때 이자율이 증가하는 기울기가 더욱 증가됩니다. 이자율 모델 컨트랙트는 엘리파이가 지원하는 각 스테이블 코인 마다 존재합니다.

| Currency | Address |
| --- | --- |
| USDC | [0xd037fE2bFB78f4bAFAD5903241Dd284f43306B62](https://etherscan.io/address/0xd037fE2bFB78f4bAFAD5903241Dd284f43306B62) |
| USDT | [0x3047dFb0Dc3f21670BBB61311E9fa18037a4d0Ca](https://etherscan.io/address/0x3047dFb0Dc3f21670BBB61311E9fa18037a4d0Ca) |
| BUSD | [0x979c7AEf8EF58Aa9cd456F8195258140dA275688](https://bscscan.com/address/0x979c7AEf8EF58Aa9cd456F8195258140dA275688) |
| DAI | [0x579564be7F01b6D61617E1A01D2CdB4A0C045003](https://etherscan.io/address/0x579564be7F01b6D61617E1A01D2CdB4A0C045003) |

이자율 모델을 결정하는 변수는 최저이자율, 최적이자율, 최적 비율 3개로 이루어져있습니다. 최저 이자율은 대출이 아예 없을 때 시작하는 이자율입니다. 최적 비율은 이자율의 기울기가 바뀌는 비율입니다. 최적 이자율은 이자율의 기울기가 바뀌는 시점의 이자율입니다. 스테이블 코인별 각 변수는 아래와 같습니다. 각 이자율은 대출이자율을 의미합니다.

| Network | 최저 이자율 | 최적 이자율 | 최적 비율 |
| --- | --- | --- | --- |
| USDC, USDT, DAI | 5% | 6% | 75% |
| BUSD | 5% | 6% | 80% |

이자율 모델의 각 변수는 엘리파이 어드민이 수정할 수 있으며, 거버넌스에서 결정한 값을 반영합니다.

이자율 모델의 자세한 스펙은 [InterestRateModel 문서](https://github.com/elysia-dev/elyfi/blob/master/docs/InterestRateModel.md)를 참고해주세요.

## Interest Rate Flow
전통적인 금융 시장의 대출 및 차입 프로세스와 달리, 엘리파이에서 투자자와 차입자는 제3의 중개인 없이 투자 및 담보대출이 가능합니다. 이자율은 자동화된 알고리즘을 통해 결정되며, 투자와 차입자는 이자율을 협상하지 않고도 자동화된 알고리즘을 통해 거래를 진행할 수 있습니다. 차입자와 투자자에게 발생하는 이자는 동일하며, 이에 대한 흐름은 아래 수식으로 세울 수 있습니다.

$$
B(t)*BR(t)=L(t)*LR(t)
$$

* $$B(t)$$ : 총차입량
* $$BR(t)$$ : 전체 평균 차입 금리
* $$L(t)$$ : 총 투자금
* $$LR(t)$$ : 전체 평균 투자 금리

## Utilization ratio
차입 수요가 증가하면 머니풀의 차입 이자 및 투자 수익이 증가하여 과도한 차입 수요를 억제하고 투자자의 유동성 공급을 유도합니다. 따라서 금리는 머니풀 이용률(U)에 의존합니다. 머니풀 이용률이란 현재 머니풀의 차입 및 투자 상태를 나타내는 변수이며, 아래와 같이 정의합니다.

$$
U(t)=\frac{B(t)}{L(t)}=\frac{B(t)}{L_L(t)+L_A(t)}
$$

* $$B(t)$$ : 총 대출
* $$L(t)$$ : 총 유동성
* $$L_L(t)$$ : 머니풀에 직접 공급된 유동성​
* $$L_A(t)$$ : 자산 채권 투자를 통해 공급된 유동성

## Kinked Borrow Rates Model
머니풀의 리스크를 최소화 할 수 있는 다양한 종류의 이자율 모델이 존재하며, 엘리파이에서는 Compound와 AAVE의 이자율 모델을 차용한 *kinked rates model*을 사용합니다.

$$
if \hspace{1mm} U < U_{optimal}:  \hspace{1cm}  BR = k_ + \frac{U(t)}{U_{optimal}} (m-k)
$$

$$
if \hspace{1mm} U \geq  U_{optimal}:  \hspace{1cm} BR = k + m + \frac{U(t)-U_{optimal}}{1-U_{optimal}}(n-m-k)
$$

* $$BR$$ : 차입금리
* $$k$$ : 기준 금리
* $$m$$ : 풀의 이용률이 최적의 값일 때의 금리
* $$n$$ : 풀의 이용률이 1일 때의 금리

*kinked rates model*은 서로 다른 두 개의 직선 그래프를 통해, 머니풀의 이용률이 최적의 이용률을 넘어 1에 가까워질 때 차입 금리가 가파르게 증가하도록 이자율을 조절합니다. 이는 머니풀 이용률이 1에 가까워짐에 따라 급격히 증가하는 머니풀의 리스크를 줄이기 위한 목적이 있습니다.

## Average Real Asset Collateralized Borrow Rate
유저  $$x$$가 시점 $$t$$에서 현물 자산을 담보로 $$m$$만큼의 가상자산을 대출는 경우, 전체 평균 현물 자산 담보 대출 이자율은 다음과 같습니다.

$$
\bar{BR}_R=\frac{\bar{BR}_R(t-1)B_R(t-1)+\bar{BR}_R(t)m}{B_R(t-1)+m}
$$

## Overall Borrow Rate
가상자산 담보 차입 금리와 현물자산 담보 차입 금리를 바탕으로 계산된 전체 차입 금리는 아래와 같습니다.

$$
BR(t)=\bar{BR}_R(t)SB_R(t)+BR_C(t)SB_C(t)
$$

* $$BR(t)$$ : 전체 차입금
* $$SB_R(t)=\frac{B_R(t)}{L(t)}$$
* $$\bar{BR}_R(t)$$ : 전체 평균 현물 자산 잠보 차입 금리
* $$SB_C(t)=\frac{B_C(t)}{L(t)}$$
* $$BR_C(t)$$ : 가상화폐 담보 차입 금리

## Liquidity
머니풀에 공급된 총 유동성은 머니풀 투자로부터 공급된 유동성과 A토큰 투자로부터 공급된 유동성으로 나뉩니다. 이는 다음과 같이 정의합니다.

$$
L(t)=L_L(t)+L_A(t)
$$

유동성 공급자는 머니풀에 직접 가상자산을 예치하거나, 혹은 자산 채권 토큰 투자를 통해 머니풀에 유동성을 공급할 수 있습니다. 유동성 공급을 바탕으로 대출 이자율을 결정하고, 발생한 대출 이자를 통해 유동성 공급자에게 보상을 제공합니다.

## LToken Lending Rate
머니풀에 유동성을 공급했을 때, 투자자의 수익률은 머니풀에서 발생하는 차입 이자 및 차입 수요를 바탕으로 계산됩니다. 이 때, 생태계 유지 및 거버넌스 참여자의 수익을 분배하기 위한 reserve factor가 있습니다. reserve factor는 거버넌스를 통해 결정됩니다.

$$
LR(t)=BR(t)*U(t)*(1-F)
$$